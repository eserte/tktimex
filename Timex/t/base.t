#!/usr/local/bin/perl -w
# -*- perl -*-

#
# $Id: base.t,v 1.3 1999/04/01 08:08:27 eserte Exp $
# Author: Slaven Rezic
#
# Copyright (C) 1998 Slaven Rezic. All rights reserved.
# This program is free software; you can redistribute it and/or
# modify it under the same terms as Perl itself.
#
# Mail: eserte@cs.tu-berlin.de
# WWW:  http://user.cs.tu-berlin.de/~eserte/
#

use lib qw(..);
use Timex::Project;

$first_project_text = <<'EOF';
#PJ1 -*- project -*-
>bbbike
/archived=0
/rcsfile=/home/e/eserte/src/bbbike/bbbike
|880036165-880037453
|880039130-880039490
|880233845-880234084
|882163085-882163826
|882195458-882200711
|882217234-882219314
|882305131-882306498
|882323718-882324492
|882730506-882731055
|882731862-882735326
|882808769-882813123
|882876107-882883882
|882884708-882887109
|882888701-882890184
|882890242-882895855
|882898676-882899278
|883235872-883240098
|883247272-883248707
|883249041-883249418
|883251221-883261801
|883267781-883269397
|883269761-883273922
|884530701-884532809
|884533979-884538278
|884622425-884626119
|884627562-884631702
|884693432-884700774
|884705474-884707444
|884708197-884708630
|884738745-884749661
|884780177-884782060
|884783323-884792898
|884794605-884796141
|884796218-884801361
|884801803-884821166
|884870956-884873682
|884876174-884879046
|884881971-884887722
|884888127-884895111
|884896386-884900908
|884902897-884922723
|885003269-885003968
|885046380-885050167
|885051468-885058136
|885131788-885135237
|885150750-885155583
|885165802-885172707
|885233697-885240566
|885300916-885305468
|885308381-885310869
|885403903-885404074
|885405143-885405507
|885474571-885477904
|885481271-885483551
|885484716-885488636
|885490514-885500242
|885604806-885618185
|885619457-885621681
|885645085-885646553
|885649184-885649777
|885656938-885659656
|885660720-885663576
|885824977-885829314
|885906186-885916077
|885919409-885920488
|885937092-885938130
|885943022-885946960
|885947461-885947711
|886037812-886046058
|886079300-886083933
|886106818-886110470
|886165295-886172682
|886295143-886296609
|886340713-886342741
|886379103-886381580
|886467100-886469066
|886592869-886594361
|886621592-886629054
|886632413-886636072
|886645473-886649034
|886861551-886867105
|886870430-886876020
|886895410-886895881
|886976231-886982940
|887044484-887046896
|887047560-887050671
|887051310-887052633
|887062389-887070979
>perl/Tk
/archived=0
|881802976-881803534
|881972480-881973877
|882469710-882471963
|882487513-882490796
|883494847-883500908
|883503669-883507292
|886004090-886008722
>main project
/archived=0
>>sub of main project
/archived=0
|234567878-4345545445
|999999998-9999999999
EOF

$second_project_text = <<'EOF';
#PJ1 -*- project -*-
>bbbike
/archived=0
/rcsfile=ignored
|887111564-887112424
|887112472-887113907
>a new project
/archived=0
|123456789-123456790
>main project
/archived=0
|034567878-4945545445
|934567878-9945545449
>>sub of main project
/archived=0
|034567878-1345545445
|234567878-4345545445
|534567878-6345545445
|734567878-8345545445
EOF

my $p1 = new Timex::Project;
my $p2 = new Timex::Project;

my @data1 = split(/\n/, $first_project_text);
my @data2 = split(/\n/, $second_project_text);

$p1->interpret_data(\@data1);
$p2->interpret_data(\@data2);

warn "Merge yields: " . $p1->merge($p2);

#print $p1->dump_data;

# print map { $_->pathname } $p2->find_by_pathname("main project")->subproject;
# print  "\n";

# print join($p2->separator,
# 	   "main project", "sub of main project"
# 	  ), "\n";
# print map {join("-", @$_)} @{$p2->find_by_pathname(join($p2->separator,
# 				 "main project", "sub of main project"
# 				)
# 			   )->{'times'}}, "\n";;
# print $p2->find_by_pathname("main project");


$sp = $p2->find_by_pathname(join($p2->separator,
				 "main project", "sub of main project"
				));
print $sp->parent->dump_data;
$sp->delete_times(1,3);
print $sp->parent->dump_data;
$sp->move_times_after(1, -1);
print $sp->parent->dump_data;
$sp->sort_times;
print $sp->parent->dump_data;

print
    "All subprojects of " . $p2->label . ":\n",
    join("\n", map { $_->label } $p2->all_subprojects), "\n";
